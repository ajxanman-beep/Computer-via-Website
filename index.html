<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pro Remote Desktop</title>
    <style>
        body { font-family: system-ui; text-align: center; background: #000; color: #fff; margin: 0; padding: 10px; overflow: hidden; }
        .ui-bar { background: #1a1a1a; padding: 10px; display: flex; justify-content: center; gap: 10px; align-items: center; border-radius: 8px; }
        #pc-screen { 
            width: 100%; max-width: 900px; border: 1px solid #444; margin-top: 10px;
            cursor: crosshair; user-select: none; -webkit-user-drag: none; 
        }
        button { padding: 8px 15px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; }
        #status { font-size: 12px; color: #00ff00; }
    </style>
</head>
<body>

    <div class="ui-bar">
        <button onmousedown="sendCmd('scroll_up')">ðŸ”¼ Up</button>
        <button onmousedown="sendCmd('scroll_down')">ðŸ”½ Down</button>
        <button onclick="sendCmd('take_screenshot')">ðŸ”„ Refresh</button>
        <span id="status">âš¡ Live</span>
    </div>

    <img id="pc-screen" 
         onmousedown="handleMouse(event, 'mousedown')" 
         onmouseup="handleMouse(event, 'mouseup')" 
         oncontextmenu="handleMouse(event, 'right_click'); return false;"
         src="" />

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAHQaoPEVTaJ8WwkHlYDdpwA-lWxYVnOts",
            authDomain: "website-computer-fe00c.firebaseapp.com",
            databaseURL: "https://website-computer-fe00c-default-rtdb.firebaseio.com",
            projectId: "website-computer-fe00c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const cmdRef = ref(db, 'pc_control/command');

        // Handles mouse and immediately triggers a screenshot for fast feedback
        window.handleMouse = function(e, type) {
            const rect = e.target.getBoundingClientRect();
            const x = (e.clientX - rect.left) / rect.width;
            const y = (e.clientY - rect.top) / rect.height;
            
            set(cmdRef, { action: type, x: x, y: y, timestamp: Date.now() });
            setTimeout(() => sendCmd('take_screenshot'), 50); 
        };

        window.sendCmd = (action) => {
            set(cmdRef, { action: action, timestamp: Date.now() });
        };

        // Keyboard Listener
        window.addEventListener('keydown', (e) => {
            if (["ArrowUp","ArrowDown"," "].includes(e.key)) e.preventDefault();
            let key = e.key.toLowerCase();
            sendCmd(key === " " ? "space" : key);
            setTimeout(() => sendCmd('take_screenshot'), 50);
        });

        // Screenshot Listener (Decodes WebP)
        onValue(ref(db, 'pc_control/screenshot/image'), (s) => {
            const data = s.val();
            if (data) document.getElementById('pc-screen').src = "data:image/webp;base64," + data;
        });

        // Loop to keep screen updated even without input
        setInterval(() => sendCmd('take_screenshot'), 400); 

    </script>
</body>
</html>
