<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>High-Speed Remote PC</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #000; color: #fff; margin: 0; padding: 10px; }
        #pc-screen { width: 100%; max-width: 900px; border: 2px solid #444; cursor: crosshair; user-select: none; }
        .ui-bar { background: #222; padding: 10px; display: flex; justify-content: center; gap: 10px; }
        button { padding: 10px; background: #3498db; color: white; border: none; border-radius: 4px; }
        button.scroll { background: #e67e22; }
    </style>
</head>
<body>

    <div class="ui-bar">
        <button onmousedown="sendCommand('scroll_up')">ðŸ”¼ Scroll Up</button>
        <button onmousedown="sendCommand('scroll_down')">ðŸ”½ Scroll Down</button>
        <button onclick="toggleTurbo()">ðŸš€ Turbo: <span id="turbo-status">OFF</span></button>
        <div id="fps-counter" style="font-size: 12px; color: #aaa;">FPS: 0</div>
    </div>

    <div class="screen-container">
        <img id="pc-screen" 
             onmousedown="handleMouse(event, 'mousedown')" 
             onmouseup="handleMouse(event, 'mouseup')" 
             oncontextmenu="event.preventDefault(); handleMouse(event, 'right_click')"
             src="" />
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAHQaoPEVTaJ8WwkHlYDdpwA-lWxYVnOts",
            authDomain: "website-computer-fe00c.firebaseapp.com",
            databaseURL: "https://website-computer-fe00c-default-rtdb.firebaseio.com",
            projectId: "website-computer-fe00c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let turbo = false;
        let lastTime = Date.now();

        // MOUSE LOGIC (Dragging)
        window.handleMouse = function(e, type) {
            const rect = e.target.getBoundingClientRect();
            const x = (e.clientX - rect.left) / rect.width;
            const y = (e.clientY - rect.top) / rect.height;
            set(ref(db, 'pc_control/command'), { action: type, x: x, y: y, timestamp: Date.now() });
        };

        // KEYBOARD LOGIC
        window.addEventListener('keydown', (e) => {
            if (["ArrowUp","ArrowDown","Space"].includes(e.code)) e.preventDefault();
            set(ref(db, 'pc_control/command'), { action: e.key.toLowerCase(), timestamp: Date.now() });
        });

        // REFRESH LOGIC
        window.toggleTurbo = () => {
            turbo = !turbo;
            document.getElementById('turbo-status').innerText = turbo ? "ON" : "OFF";
        };

        setInterval(() => {
            set(ref(db, 'pc_control/command'), { action: 'take_screenshot', timestamp: Date.now() });
        }, 500); // 500ms is safe. If you go to 100ms, Firebase may ban your IP temporarily.

        onValue(ref(db, 'pc_control/screenshot/image'), (s) => {
            const data = s.val();
            if (data) {
                document.getElementById('pc-screen').src = "data:image/jpeg;base64," + data;
                const now = Date.now();
                document.getElementById('fps-counter').innerText = "Latency: " + (now - lastTime) + "ms";
                lastTime = now;
            }
        });

        window.sendCommand = (action) => {
             set(ref(db, 'pc_control/command'), { action: action, timestamp: Date.now() });
        };
    </script>
</body>
</html>
